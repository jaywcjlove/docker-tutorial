<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jenkins Docker å…¥é—¨æ•™ç¨‹</title>
    <meta name="description" content="æœ¬æ•™ç¨‹å±•ç¤ºå¦‚ä½•åœ¨ Linux(CentOS 7) æœåŠ¡å™¨ä¸Šé€šè¿‡ Docker éƒ¨ç½² Jenkinsï¼Œå¹¶åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ Pipeline è„šæœ¬ã€‚è¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨ä»»ä½•ç‰ˆæœ¬çš„ Node.js æˆ– Java æ²™ç›’ç¯å¢ƒã€‚">
    <meta name="keywords" content="docker,containers,tutorial">
    <link rel="stylesheet" type="text/css" href="../css/main.css?v=1.31.0">
    <link rel="stylesheet" type="text/css" href="../css/tocbot.css?v=1.31.0">
    <link rel="stylesheet" type="text/css" href="../css/media.css?v=1.31.0">
    <link rel="stylesheet" type="text/css" href="../css/sidebar.css?v=1.31.0">
    <link rel="stylesheet" type="text/css" href="../css/copy.css?v=1.31.0">
    <link rel="stylesheet" type="text/css" href="../css/demo-preview.css?v=1.31.0">
    <link rel="icon" href="../img/logo.svg" type="image/x-icon">
    <script src="../js/copy.js?v=1.31.0"></script>
    <script src="../js/dark-mode.js?v=1.31.0"></script>
    <script src="../js/markdown-style.js?v=1.31.0"></script>
  </head>
  <body id="idoctotop"><a href="#idoctotop" class="gototop">top</a>
    <header class="header">
      <article class="inner warpper"><a class="logo" href="../index.html"><svg viewBox="0 0 1280 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M699.88718 472.6h-132.2v-118.8h132.2v118.8z m0-408.6h-132.2v121.4h132.2V64z m156.4 289.6H724.08718v118.8h132.2v-118.8z m-312.6-144.2h-132.2v120.2h132.2v-120.2z m156.2 0h-132.2v120.2h132.2v-120.2z m553.6 200c-28.8-19.4-95.2-26.4-146.2-16.8-6.6-48-33.4-89.8-82.2-127.4l-28-18.6-18.6 28c-36.8 55.6-46.8 147.2-7.4 207.6-17.4 9.4-51.6 22.2-96.8 21.4H4.88718c-17.4 101.6 11.6 233.6 88 324.2 74.2 87.8 185.4 132.4 330.8 132.4 314.8 0 547.8-145 656.8-408.4 42.8 0.8 135.2 0.2 182.6-90.4 3-5 13.2-26.4 17-34.2l-26.6-17.8z m-1022.2-55.8h-132v118.8h132.2v-118.8z m156.2 0h-132.2v118.8h132.2v-118.8z m156.2 0h-132.2v118.8h132.2v-118.8z m-156.2-144.2h-132.2v120.2h132.2v-120.2z" fill="#0187D1"></path>
          </svg>
<span class="title">Docker å…¥é—¨æ•™ç¨‹</span></a>
        <div class="content">
          <ul class="menu">
            <li><a href="../index.html" target="" class="">é¦–é¡µ</a></li>
            <li><a href="https://wangchujiang.com/#/sponsor" target="__blank" class="">æèµ </a></li>
          </ul><a href="https://github.com/jaywcjlove/docker-tutorial" target="_blank" rel="noopener noreferrer" title="Github" name="Github" class="github"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg></a>
          <dark-mode permanent=""></dark-mode>
        </div>
      </article>
    </header>
    <div class="warpper-content warpper sidebar">
      <div class="sidebar-border">
        <aside class="sidebar" role="navigation">
          <div>
            <a href="../index.html" class="">å…¥é—¨</a>
            <label>å®è·µ</label>
            <a href="../docker-compose.html" class="">Docker Compose</a>
            <a href="../elasticsearch.html" class="">ElasticSearch æœç´¢æœåŠ¡å™¨</a>
            <a href="../gitlab/index.html" class="">Gitlab ä»£ç ä»“åº“ç®¡ç†ç³»ç»Ÿ</a>
            <a href="../harbor.html" class="">Harbor</a>
            <a href="../mattermost.html" class="">Mattermost èŠå¤©å·¥å…·</a>
            <a href="../mysql.html" class="">MySQL æ•°æ®åº“</a>
            <a href="../nginx.html" class="">Nginx Web æœåŠ¡å™¨</a>
            <a href="../nps/index.html" class="">NPS å†…ç½‘ç©¿é€</a>
            <a href="../portainer.html" class="">Portainer Docker ç®¡ç†</a>
            <a href="../postgres.html" class="">PostgreSQL æ•°æ®åº“</a>
            <a href="../penpot.html" class="">Penpot è®¾è®¡å’ŒåŸå‹</a>
            <a href="../navidrome.html" class="">Navidrome éŸ³ä¹æœåŠ¡å™¨</a>
            <a href="../rancher.html" class="">Rancher å®¹å™¨ç®¡ç†å¹³å°</a>
            <a href="../redis.html" class="">Redis æ•°æ®åº“</a>
            <a href="index.html" class="active">Jenkins</a>
            <a href="../rocket.chat/index.html" class="">Rocket.Chat èŠå¤©å·¥å…·</a>
            <a href="../seaweedfs/index.html" class="">SeaweedFS æ–‡ä»¶ç³»ç»Ÿ</a>
            <a href="../sourcegraph/index.html" class="">Sourcegraph ä»£ç æœç´¢å¼•æ“</a>
          </div>
        </aside>
      </div>
      <markdown-style theme-auto-switch-disabled="">
        <h1 id="jenkins"><a aria-hidden="true" tabindex="-1" href="#jenkins" class="anchor"><span class="icon icon-link"></span></a>Jenkins</h1>
        <p>æœ¬æ•™ç¨‹å±•ç¤ºå¦‚ä½•åœ¨ Linux(CentOS 7) æœåŠ¡å™¨ä¸Šé€šè¿‡ Docker éƒ¨ç½² Jenkinsï¼Œå¹¶åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ Pipeline è„šæœ¬ã€‚è¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨ä»»ä½•ç‰ˆæœ¬çš„ Node.js æˆ– Java æ²™ç›’ç¯å¢ƒã€‚</p>
        <h2 id="éƒ¨ç½²-jenkins"><a aria-hidden="true" tabindex="-1" href="#éƒ¨ç½²-jenkins" class="anchor"><span class="icon icon-link"></span></a>éƒ¨ç½² Jenkins</h2>
        <p>ç”±äºå›½å†…æœåŠ¡å™¨æ— æ³•ç›´æ¥æ‹‰å– Docker é•œåƒï¼Œéœ€è¦å…ˆé€šè¿‡æœ¬æœº VPN ä¸‹è½½ Jenkins å’Œ Jenkins agent é•œåƒï¼Œç„¶åä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p>
        <pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line line-number" line="1"><span class="token comment"># è·å– Jenkins é•œåƒ</span>
</span><span class="code-line line-number" line="2"><span class="token function">docker</span> pull <span class="token parameter variable">--platform</span> linux/amd64 jenkins/jenkins:2.468-jdk21
</span><span class="code-line line-number" line="3"><span class="token comment"># ä¿å­˜ Docker é•œåƒåˆ°æœ¬åœ°æ–‡ä»¶</span>
</span><span class="code-line line-number" line="4"><span class="token function">docker</span> save <span class="token parameter variable">-o</span> jenkins-2.468-jdk21.tar jenkins/jenkins:2.468-jdk21
</span><span class="code-line line-number" line="5"><span class="token comment"># ä¸Šä¼ åˆ°æœåŠ¡å™¨</span>
</span><span class="code-line line-number" line="6"><span class="token function">scp</span> <span class="token parameter variable">-P</span> <span class="token number">2222</span> jenkins-2.468-jdk21.tar root@152.22.3.186:/home/docker-images
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8"><span class="token comment"># è·å– Jenkins agent é•œåƒ</span>
</span><span class="code-line line-number" line="9"><span class="token function">docker</span> pull <span class="token parameter variable">--platform</span> linux/amd64 jenkins/ssh-agent:jdk21
</span><span class="code-line line-number" line="10"><span class="token function">docker</span> save <span class="token parameter variable">-o</span> jenkins-ssh-agent-jdk21.tar jenkins/ssh-agent:jdk21
</span><span class="code-line line-number" line="11"><span class="token function">scp</span> <span class="token parameter variable">-P</span> <span class="token number">2222</span> jenkins-ssh-agent-jdk21.tar root@152.22.3.186:/home/docker-images
</span></code><input type="hidden" value="# è·å– Jenkins é•œåƒ
docker pull --platform linux/amd64 jenkins/jenkins:2.468-jdk21
# ä¿å­˜ Docker é•œåƒåˆ°æœ¬åœ°æ–‡ä»¶
docker save -o jenkins-2.468-jdk21.tar jenkins/jenkins:2.468-jdk21
# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp -P 2222 jenkins-2.468-jdk21.tar root@152.22.3.186:/home/docker-images

# è·å– Jenkins agent é•œåƒ
docker pull --platform linux/amd64 jenkins/ssh-agent:jdk21
docker save -o jenkins-ssh-agent-jdk21.tar jenkins/ssh-agent:jdk21
scp -P 2222 jenkins-ssh-agent-jdk21.tar root@152.22.3.186:/home/docker-images
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>åŸºäº <code>jenkins/jenkins:2.468-jdk21</code> é•œåƒæ·»åŠ  Docker æ”¯æŒï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Jenkins é•œåƒã€‚ä»¥ä¸‹æ˜¯ <code>Dockerfile</code> é…ç½®å†…å®¹ï¼š</p>
        <pre class="language-dockerfile"><code class="language-Dockerfile code-highlight"><span class="code-line line-number" line="1"><span class="token instruction"><span class="token keyword">FROM</span> <span class="token options"><span class="token property">--platform</span><span class="token punctuation">=</span><span class="token string">linux/amd64</span></span> jenkins/jenkins:2.468-jdk21</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token comment"># åˆ‡æ¢åˆ° root ç”¨æˆ·ä»¥å®‰è£… Docker CLI</span>
</span><span class="code-line line-number" line="4"><span class="token instruction"><span class="token keyword">USER</span> root</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6"><span class="token comment"># å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ…</span>
</span><span class="code-line line-number" line="7"><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &#x26;&#x26; apt-get install -y <span class="token operator">\</span>
</span></span><span class="code-line line-number" line="8"><span class="token instruction">    curl <span class="token operator">\</span>
</span></span><span class="code-line line-number" line="9"><span class="token instruction">    gnupg2 <span class="token operator">\</span>
</span></span><span class="code-line line-number" line="10"><span class="token instruction">    lsb-release <span class="token operator">\</span>
</span></span><span class="code-line line-number" line="11"><span class="token instruction">    software-properties-common</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13"><span class="token comment"># å®‰è£… Docker CLI</span>
</span><span class="code-line line-number" line="14"><span class="token comment"># RUN curl -fsSL https://get.docker.com | sh</span>
</span><span class="code-line line-number" line="15"><span class="token comment"># å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„ Docker CLI</span>
</span><span class="code-line line-number" line="16"><span class="token instruction"><span class="token keyword">RUN</span> curl -fsSL https://download.docker.com/linux/static/stable/x86_64/docker-26.1.4.tgz | tar xzvf - --strip-components=1 -C /usr/local/bin</span>
</span><span class="code-line line-number" line="17">
</span><span class="code-line line-number" line="18"><span class="token comment"># åˆ›å»º docker ç»„å¹¶å°† jenkins ç”¨æˆ·æ·»åŠ åˆ°è¯¥ç»„</span>
</span><span class="code-line line-number" line="19"><span class="token instruction"><span class="token keyword">RUN</span> groupadd docker &#x26;&#x26; usermod -aG docker jenkins</span>
</span><span class="code-line line-number" line="20">
</span><span class="code-line line-number" line="21"><span class="token comment"># åˆ‡æ¢å› jenkins ç”¨æˆ·</span>
</span><span class="code-line line-number" line="22"><span class="token instruction"><span class="token keyword">USER</span> jenkins</span>
</span></code><input type="hidden" value="FROM --platform=linux/amd64 jenkins/jenkins:2.468-jdk21

# åˆ‡æ¢åˆ° root ç”¨æˆ·ä»¥å®‰è£… Docker CLI
USER root

# å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ…
RUN apt-get update &#x26;&#x26; apt-get install -y \
    curl \
    gnupg2 \
    lsb-release \
    software-properties-common

# å®‰è£… Docker CLI
# RUN curl -fsSL https://get.docker.com | sh
# å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„ Docker CLI
RUN curl -fsSL https://download.docker.com/linux/static/stable/x86_64/docker-26.1.4.tgz | tar xzvf - --strip-components=1 -C /usr/local/bin

# åˆ›å»º docker ç»„å¹¶å°† jenkins ç”¨æˆ·æ·»åŠ åˆ°è¯¥ç»„
RUN groupadd docker &#x26;&#x26; usermod -aG docker jenkins

# åˆ‡æ¢å› jenkins ç”¨æˆ·
USER jenkins
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>æ„å»º Jenkins æ–°çš„é•œåƒï¼Œå‘½åä¸º <code>my-jenkins-docker-2468-jdk21</code></p>
        <pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line line-number" line="1"><span class="token function">docker</span> build <span class="token parameter variable">--platform</span><span class="token operator">=</span>linux/amd64 <span class="token parameter variable">-t</span> my-jenkins-docker-2468-jdk21 <span class="token builtin class-name">.</span>
</span><span class="code-line line-number" line="2"><span class="token comment"># ä¿å­˜ Docker é•œåƒä¸ºä¸€ä¸ª tar æ–‡ä»¶</span>
</span><span class="code-line line-number" line="3"><span class="token function">docker</span> save <span class="token parameter variable">-o</span> my-jenkins-docker-2468-jdk21.tar my-jenkins-docker-2468-jdk21
</span><span class="code-line line-number" line="4"><span class="token comment"># é€šè¿‡ SCP ä¼ è¾“ tar æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨</span>
</span><span class="code-line line-number" line="5"><span class="token function">scp</span> <span class="token parameter variable">-P</span> <span class="token number">2222</span> my-jenkins-docker-2468-jdk21.tar root@152.22.3.186:/home/docker-images
</span></code><input type="hidden" value="docker build --platform=linux/amd64 -t my-jenkins-docker-2468-jdk21 .
# ä¿å­˜ Docker é•œåƒä¸ºä¸€ä¸ª tar æ–‡ä»¶
docker save -o my-jenkins-docker-2468-jdk21.tar my-jenkins-docker-2468-jdk21
# é€šè¿‡ SCP ä¼ è¾“ tar æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨
scp -P 2222 my-jenkins-docker-2468-jdk21.tar root@152.22.3.186:/home/docker-images
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>åœ¨æœåŠ¡å™¨ä¸Šæ·»åŠ  Docker Compose é…ç½® <code>docker-compose.yml</code>ã€‚ä»¥ä¸‹æ˜¯ <code>docker-compose.yml</code> é…ç½®å†…å®¹ï¼š</p>
        <pre class="language-yml"><code class="language-yml code-highlight"><span class="code-line line-number" line="1"><span class="token comment"># https://github.com/jenkinsci/docker/blob/master/README.md#docker-compose-with-jenkins</span>
</span><span class="code-line line-number" line="2"><span class="token key atrule">services</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="3">  <span class="token key atrule">jenkins</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="4">    <span class="token key atrule">image</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>jenkins<span class="token punctuation">-</span>docker<span class="token punctuation">-</span>2468<span class="token punctuation">-</span>jdk21 <span class="token comment"># è‡ªå®šä¹‰é•œåƒ</span>
</span><span class="code-line line-number" line="5">    <span class="token comment">#image: jenkins/jenkins:2.468-jdk21</span>
</span><span class="code-line line-number" line="6">    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="7">        <span class="token punctuation">-</span> <span class="token string">"8086:8080"</span>
</span><span class="code-line line-number" line="8">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="9">        <span class="token comment"># å°†å‘½åå· jenkins_home æŒ‚è½½åˆ°å®¹å™¨å†…çš„ /var/jenkins_home ç›®å½•ï¼Œç”¨äºæŒä¹…åŒ– Jenkins çš„æ•°æ®ã€‚</span>
</span><span class="code-line line-number" line="10">        <span class="token punctuation">-</span> jenkins_home<span class="token punctuation">:</span>/var/jenkins_home
</span><span class="code-line line-number" line="11">        <span class="token comment"># å°†å®¿ä¸»æœºçš„ Docker æŒ‚è½½åˆ°å®¹å™¨å†…ï¼Œä»¥ä¾¿åœ¨ Jenkins å®¹å™¨å†…ç›´æ¥è®¿é—® Docker å¼•æ“ï¼Œä»è€Œæ”¯æŒåœ¨ Jenkins ä¸­è¿è¡Œ Docker å‘½ä»¤ã€‚</span>
</span><span class="code-line line-number" line="12">        <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock
</span><span class="code-line line-number" line="13">  <span class="token key atrule">ssh-agent</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="14">    <span class="token key atrule">image</span><span class="token punctuation">:</span> jenkins/ssh<span class="token punctuation">-</span>agent<span class="token punctuation">:</span>jdk21
</span><span class="code-line line-number" line="15"><span class="token key atrule">volumes</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="16">  <span class="token key atrule">jenkins_home</span><span class="token punctuation">:</span>
</span></code><input type="hidden" value="# https://github.com/jenkinsci/docker/blob/master/README.md#docker-compose-with-jenkins
services:
  jenkins:
    image: my-jenkins-docker-2468-jdk21 # è‡ªå®šä¹‰é•œåƒ
    #image: jenkins/jenkins:2.468-jdk21
    ports:
        - &#x22;8086:8080&#x22;
    volumes:
        # å°†å‘½åå· jenkins_home æŒ‚è½½åˆ°å®¹å™¨å†…çš„ /var/jenkins_home ç›®å½•ï¼Œç”¨äºæŒä¹…åŒ– Jenkins çš„æ•°æ®ã€‚
        - jenkins_home:/var/jenkins_home
        # å°†å®¿ä¸»æœºçš„ Docker æŒ‚è½½åˆ°å®¹å™¨å†…ï¼Œä»¥ä¾¿åœ¨ Jenkins å®¹å™¨å†…ç›´æ¥è®¿é—® Docker å¼•æ“ï¼Œä»è€Œæ”¯æŒåœ¨ Jenkins ä¸­è¿è¡Œ Docker å‘½ä»¤ã€‚
        - /var/run/docker.sock:/var/run/docker.sock
  ssh-agent:
    image: jenkins/ssh-agent:jdk21
volumes:
  jenkins_home:
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>ç¡®ä¿ä¸ <code>docker-compose.yml</code> åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ã€‚å¹¶å¯åŠ¨ <code>Jenkins</code>:</p>
        <pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line line-number" line="1"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span> <span class="token comment"># å¯åŠ¨ Jenkins</span>
</span><span class="code-line line-number" line="2"><span class="token function">docker</span> compose down  <span class="token comment"># åœæ­¢å¹¶åˆ é™¤ä¸ Docker Compose é…ç½®æ–‡ä»¶ç›¸å…³çš„æ‰€æœ‰å®¹å™¨ã€ç½‘ç»œã€å·å’Œé•œåƒ</span>
</span></code><input type="hidden" value="docker compose up -d # å¯åŠ¨ Jenkins
docker compose down  # åœæ­¢å¹¶åˆ é™¤ä¸ Docker Compose é…ç½®æ–‡ä»¶ç›¸å…³çš„æ‰€æœ‰å®¹å™¨ã€ç½‘ç»œã€å·å’Œé•œåƒ
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>è®¿é—® jenkins: <a href="http://152.22.3.186:8086/">http://152.22.3.186:8086/</a></p>
        <h2 id="1-å®‰è£…æ’ä»¶"><a aria-hidden="true" tabindex="-1" href="#1-å®‰è£…æ’ä»¶" class="anchor"><span class="icon icon-link"></span></a>1. å®‰è£…æ’ä»¶</h2>
        <p><a href="https://plugins.jenkins.io/git-parameter">Git Parameter Plug-In</a> æ”¯æŒåœ¨ CI ä¸Šè‡ªåŠ¨åŠ è½½ä»“åº“åˆ†æ”¯</p>
        <img src="imgs/0-1.png" width="620">
        <img src="imgs/0-2.png" width="620">
        <p>åœ¨ <code>Manage Jenkins</code> -> <code>System</code> ä¸­è®¾ç½® <code>Git Parameter</code></p>
        <img src="imgs/0-3.png" width="620">
        <h2 id="2-æ·»åŠ å‡­æ®"><a aria-hidden="true" tabindex="-1" href="#2-æ·»åŠ å‡­æ®" class="anchor"><span class="icon icon-link"></span></a>2. æ·»åŠ å‡­æ®</h2>
        <img src="imgs/1.png" width="620">
        <img src="imgs/2.png" width="620">
        <img src="imgs/3.png" width="620">
        <img src="imgs/4.png" width="620">
        <p>æ·»åŠ  <code>SSH</code> å’Œ <code>SCP</code> éœ€è¦çš„å‡­æ®</p>
        <img src="imgs/4-1.png" width="620">
        <p><code>ssh-keygen -t rsa</code> ç”Ÿæˆ <code>id_rsa</code> å’Œ <code>id_rsa.pub</code> æ–‡ä»¶ï¼Œå°† <code>id_rsa</code> ç§é’¥æ–‡æœ¬å¤åˆ¶åˆ° <code>jenkins</code> ä¸­</p>
        <img src="imgs/4-2.png" width="620">
        <h2 id="3-æ–°å»ºå·¥ä½œæµ"><a aria-hidden="true" tabindex="-1" href="#3-æ–°å»ºå·¥ä½œæµ" class="anchor"><span class="icon icon-link"></span></a>3. æ–°å»ºå·¥ä½œæµ</h2>
        <img src="imgs/5.png" width="620">
        <p>ä¿®æ”¹é…ç½®</p>
        <img src="imgs/6.png" width="620">
        <p>è®¾ç½® <a href="https://plugins.jenkins.io/git-parameter"><code>Git Parameter</code></a> å¯ä»¥åœ¨æ„å»ºçš„æ—¶å€™è¯»å–åˆ†æ”¯ï¼Œé€‰æ‹©åˆ†æ”¯</p>
        <img src="imgs/7.png" width="620">
        <img src="imgs/8.png" width="620">
        <h2 id="3-æ·»åŠ æ„å»ºé€‰é¡¹"><a aria-hidden="true" tabindex="-1" href="#3-æ·»åŠ æ„å»ºé€‰é¡¹" class="anchor"><span class="icon icon-link"></span></a>3. æ·»åŠ æ„å»ºé€‰é¡¹</h2>
        <p>å¯ä»¥åœ¨æ„å»ºå‰é€‰æ‹© <code>ç”Ÿäº§</code> è¿˜æ˜¯ <code>å¼€å‘</code> æ¨¡å¼ï¼Œåœ¨è„šæœ¬ä¸­åˆ¤æ–­</p>
        <img src="imgs/9.png" width="620">
        <h2 id="4-é€‰æ‹©-pipeline-script-from-scm-æŒ‡å®šè„šæœ¬ä½ç½®"><a aria-hidden="true" tabindex="-1" href="#4-é€‰æ‹©-pipeline-script-from-scm-æŒ‡å®šè„šæœ¬ä½ç½®" class="anchor"><span class="icon icon-link"></span></a>4. é€‰æ‹© <code>Pipeline script from SCM</code> æŒ‡å®šè„šæœ¬ä½ç½®</h2>
        <img src="imgs/10.png" width="620">
        <p>è¿™æ–¹æ³•æ˜¯å°† ä»“åº“ <code>config</code> åˆ†æ”¯æ·»åŠ ä¸€ä¸ª <code>Jenkinsfile</code> é…ç½®</p>
        <h2 id="nodejs"><a aria-hidden="true" tabindex="-1" href="#nodejs" class="anchor"><span class="icon icon-link"></span></a>Nodejs</h2>
        <p>å®‰è£… <a href="https://plugins.jenkins.io/git-parameter">Docker Pipeline</a> æ’ä»¶ï¼Œæ”¯æŒä»ç®¡é“ä¸­æ„å»ºå’Œä½¿ç”¨ <code>Docker</code> å®¹å™¨ã€‚</p>
        <pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line line-number" line="1"><span class="token function">docker</span> pull <span class="token parameter variable">--platform</span> linux/amd64 node:14.16.0
</span><span class="code-line line-number" line="2"><span class="token function">docker</span> pull <span class="token parameter variable">--platform</span> linux/amd64 node:18
</span><span class="code-line line-number" line="3"><span class="token function">docker</span> pull <span class="token parameter variable">--platform</span> linux/amd64 node:20
</span><span class="code-line line-number" line="4"><span class="token function">docker</span> pull <span class="token parameter variable">--platform</span> linux/amd64 node:22
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6"><span class="token comment"># ä¿å­˜ Docker é•œåƒåˆ°æœ¬åœ°æ–‡ä»¶</span>
</span><span class="code-line line-number" line="7"><span class="token function">docker</span> save <span class="token parameter variable">-o</span> node14.16.tar node:14.16.0
</span><span class="code-line line-number" line="8"><span class="token comment"># ä¸Šä¼ åˆ°æœåŠ¡å™¨</span>
</span><span class="code-line line-number" line="9"><span class="token function">scp</span> <span class="token parameter variable">-P</span> <span class="token number">2222</span> node14.16.tar root@152.22.3.186:/home/docker-images
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11"><span class="token function">docker</span> save <span class="token parameter variable">-o</span> node18.tar node:18
</span><span class="code-line line-number" line="12"><span class="token function">scp</span> <span class="token parameter variable">-P</span> <span class="token number">2222</span> node18.tar root@152.22.3.186:/home/docker-images
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14"><span class="token function">docker</span> save <span class="token parameter variable">-o</span> node20.tar node:20
</span><span class="code-line line-number" line="15"><span class="token function">scp</span> <span class="token parameter variable">-P</span> <span class="token number">2222</span> node20.tar root@152.22.3.186:/home/docker-images
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17"><span class="token function">docker</span> save <span class="token parameter variable">-o</span> node22.tar node:22
</span><span class="code-line line-number" line="18"><span class="token function">scp</span> <span class="token parameter variable">-P</span> <span class="token number">2222</span> node22.tar root@152.22.3.186:/home/docker-images
</span></code><input type="hidden" value="docker pull --platform linux/amd64 node:14.16.0
docker pull --platform linux/amd64 node:18
docker pull --platform linux/amd64 node:20
docker pull --platform linux/amd64 node:22

# ä¿å­˜ Docker é•œåƒåˆ°æœ¬åœ°æ–‡ä»¶
docker save -o node14.16.tar node:14.16.0
# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp -P 2222 node14.16.tar root@152.22.3.186:/home/docker-images

docker save -o node18.tar node:18
scp -P 2222 node18.tar root@152.22.3.186:/home/docker-images

docker save -o node20.tar node:20
scp -P 2222 node20.tar root@152.22.3.186:/home/docker-images

docker save -o node22.tar node:22
scp -P 2222 node22.tar root@152.22.3.186:/home/docker-images
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>Pipeline è„šæœ¬ä¸­ä½¿ç”¨ Docker <code>nodejs 20</code> è¿è¡Œç¤ºä¾‹</p>
        <pre class="language-groovy"><code class="language-groovy code-highlight"><span class="code-line line-number" line="1">pipeline <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">    <span class="token comment">//agent any</span>
</span><span class="code-line line-number" line="3">    <span class="token comment">// pipeline æ”¾åˆ° docker ä¸­æ‰§è¡Œ</span>
</span><span class="code-line line-number" line="4">    agent <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">        docker <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">            <span class="token comment">// ä½¿ç”¨ Node.js 18 çš„ Docker é•œåƒ</span>
</span><span class="code-line line-number" line="7">            image <span class="token string">'node:20'</span>
</span><span class="code-line line-number" line="8">            <span class="token comment">// å¯é€‰ï¼šæŒ‚è½½ NPM ç¼“å­˜ç›®å½•ï¼ŒåŠ é€Ÿæ„å»º</span>
</span><span class="code-line line-number" line="9">            <span class="token comment">// ä½¿ç”¨ Jenkins å·¥ä½œç©ºé—´ä¸­çš„ .npm ç›®å½•ä½œä¸ºç¼“å­˜ç›®å½•ï¼Œä¸ä¼šæœ‰æƒé™å†™å…¥é—®é¢˜</span>
</span><span class="code-line line-number" line="10">            args <span class="token string">'-v ${JENKINS_HOME}/.npm:/home/node/.npm'</span>
</span><span class="code-line line-number" line="11">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="12">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="13">    environment <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="14">        <span class="token keyword">def</span> git_url<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">"http://152.22.3.186:8081/mall/h5.git"</span></span>
</span><span class="code-line line-number" line="15">        <span class="token keyword">def</span> git_auth <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"12312312-f199-4b15-b087-123123"</span></span>
</span><span class="code-line line-number" line="16">        <span class="token keyword">def</span> git_branch <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">branch</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
</span><span class="code-line line-number" line="17">        <span class="token keyword">def</span> project_env <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">project_env</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
</span><span class="code-line line-number" line="18">        <span class="token keyword">def</span> data_dir <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"/mnt/mall/h5/h5_vip"</span></span>
</span><span class="code-line line-number" line="19">
</span><span class="code-line line-number" line="20">        <span class="token comment">// æœ¬åœ°éœ€è¦ä¸Šä¼ çš„ç›®å½• ä»¥åŠè¿œç¨‹æœåŠ¡å™¨çš„ç›®å½•</span>
</span><span class="code-line line-number" line="21">        <span class="token keyword">def</span> localDir <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">WORKSPACE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/h5_vip/test_dir/"</span></span>
</span><span class="code-line line-number" line="22">        <span class="token keyword">def</span> vip_host <span class="token operator">=</span> <span class="token string">'152.22.3.186'</span>
</span><span class="code-line line-number" line="23">        <span class="token keyword">def</span> vip_remote_dir <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"/mnt/mall/h5"</span></span>
</span><span class="code-line line-number" line="24">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="25">    stages <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="26">        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Git Checkout'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="27">            steps <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="28">                echo <span class="token interpolation-string"><span class="token string">"ğŸ† WORKSPACE: ã€</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">WORKSPACE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ã€‘"</span></span>
</span><span class="code-line line-number" line="29">                echo <span class="token interpolation-string"><span class="token string">"ğŸ¯ branch: ã€</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">git_branch</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ã€‘"</span></span>
</span><span class="code-line line-number" line="30">                echo <span class="token interpolation-string"><span class="token string">"ğŸ… project_env: ã€</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">project_env</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ã€‘"</span></span>
</span><span class="code-line line-number" line="31">                echo <span class="token string">'check git'</span>
</span><span class="code-line line-number" line="32">                <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
</span><span class="code-line line-number" line="33">                    <span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'GitSCM'</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="34">                    branches<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">git_branch</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="35">                    doGenerateSubmoduleConfigurations<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="36">                    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="37">                    submoduleCfg<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="38">                    userRemoteConfigs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>
</span><span class="code-line line-number" line="39">                    credentialsId<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">git_auth</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="40">                        url<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">git_url</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
</span><span class="code-line line-number" line="41">                    <span class="token punctuation">]</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="42">                <span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="43">                sh <span class="token string">'pwd'</span>
</span><span class="code-line line-number" line="44">                sh <span class="token string">'ls -la'</span>
</span><span class="code-line line-number" line="45">            <span class="token punctuation">}</span>    
</span><span class="code-line line-number" line="46">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="47">        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Send Files'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="48">            when <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="49">                expression <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="50">                    currentBuild<span class="token punctuation">.</span>result <span class="token operator">==</span> null <span class="token operator">||</span> currentBuild<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">'SUCCESS'</span>
</span><span class="code-line line-number" line="51">                <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="52">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="53">            steps <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="54">                sh <span class="token string">'pwd'</span>
</span><span class="code-line line-number" line="55">                script <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="56">                    <span class="token keyword">switch</span> <span class="token punctuation">(</span>project_env<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="57">                        <span class="token keyword">case</span> <span class="token interpolation-string"><span class="token string">"vip"</span></span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="58">                            sh <span class="token string">'''
</span></span><span class="code-line line-number" line="59"><span class="token string">                            ls -la
</span></span><span class="code-line line-number" line="60"><span class="token string">                            cd h5_vip
</span></span><span class="code-line line-number" line="61"><span class="token string">                            npm install --cache /home/node/.npm --registry=https://registry.npmmirror.com/
</span></span><span class="code-line line-number" line="62"><span class="token string">                            ls -la
</span></span><span class="code-line line-number" line="63"><span class="token string">                            npm run build
</span></span><span class="code-line line-number" line="64"><span class="token string">                            ls -la
</span></span><span class="code-line line-number" line="65"><span class="token string">                            rm -rf test_dir
</span></span><span class="code-line line-number" line="66"><span class="token string">                            mv dist test_dir
</span></span><span class="code-line line-number" line="67"><span class="token string">                            '''</span>
</span><span class="code-line line-number" line="68">                            <span class="token function">withCredentials</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">sshUserPrivateKey</span><span class="token punctuation">(</span>credentialsId<span class="token punctuation">:</span> <span class="token string">'9dfd-4fd5-b94b-7559ca212e9a'</span><span class="token punctuation">,</span> keyFileVariable<span class="token punctuation">:</span> <span class="token string">'SSH_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="69">                                <span class="token comment">// è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å¹¶åˆ é™¤ test_dir ç›®å½• é‡æ–°ä¸Šä¼ </span>
</span><span class="code-line line-number" line="70">                                sh <span class="token string">'''
</span></span><span class="code-line line-number" line="71"><span class="token string">                                ssh -i ${SSH_KEY} -o StrictHostKeyChecking=no root@152.22.3.186 "rm -rf /mnt/mall/h5/test_dir"
</span></span><span class="code-line line-number" line="72"><span class="token string">                                scp -i ${SSH_KEY} -o StrictHostKeyChecking=no -P 22 -r "${localDir}" root@152.22.3.186:${vip_remote_dir}
</span></span><span class="code-line line-number" line="73"><span class="token string">                                '''</span>
</span><span class="code-line line-number" line="74">                            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="75">                            <span class="token keyword">break</span>
</span><span class="code-line line-number" line="76">                        <span class="token keyword">case</span> <span class="token interpolation-string"><span class="token string">"dev"</span></span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="77">                            <span class="token comment">// for (i in ['152.22.3.186']) {</span>
</span><span class="code-line line-number" line="78">                            <span class="token comment">//     data_dir = "/mnt/mall/h5/"</span>
</span><span class="code-line line-number" line="79">                            <span class="token comment">//     //sh "ssh $i 'cp -rf ${data_dir}/* ${data_dir}/h5_vip_{uuid_no}'"</span>
</span><span class="code-line line-number" line="80">                            <span class="token comment">//     sh "scp -r -o StrictHostKeyChecking=no -i /var/lib/jenkins/.ssh/id_rsa -P 22 '${WORKSPACE}/h5_vip/' '$i:${data_dir}'"</span>
</span><span class="code-line line-number" line="81">                            <span class="token comment">// }</span>
</span><span class="code-line line-number" line="82">                            <span class="token keyword">break</span>
</span><span class="code-line line-number" line="83">                    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="84">                <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="85">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="86">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="87">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="88">    post <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="89">        success <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="90">            sh <span class="token interpolation-string"><span class="token string">"echo 'Success success'"</span></span>
</span><span class="code-line line-number" line="91">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="92">        
</span><span class="code-line line-number" line="93">        failure <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="94">            sh <span class="token interpolation-string"><span class="token string">"echo 'Faild faild'"</span></span>
</span><span class="code-line line-number" line="95">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="96">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="97"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="pipeline {
    //agent any
    // pipeline æ”¾åˆ° docker ä¸­æ‰§è¡Œ
    agent {
        docker {
            // ä½¿ç”¨ Node.js 18 çš„ Docker é•œåƒ
            image &#x27;node:20&#x27;
            // å¯é€‰ï¼šæŒ‚è½½ NPM ç¼“å­˜ç›®å½•ï¼ŒåŠ é€Ÿæ„å»º
            // ä½¿ç”¨ Jenkins å·¥ä½œç©ºé—´ä¸­çš„ .npm ç›®å½•ä½œä¸ºç¼“å­˜ç›®å½•ï¼Œä¸ä¼šæœ‰æƒé™å†™å…¥é—®é¢˜
            args &#x27;-v ${JENKINS_HOME}/.npm:/home/node/.npm&#x27;
        }
    }
    environment {
        def git_url=&#x22;http://152.22.3.186:8081/mall/h5.git&#x22;
        def git_auth = &#x22;12312312-f199-4b15-b087-123123&#x22;
        def git_branch = &#x22;${branch}&#x22;
        def project_env = &#x22;${project_env}&#x22;
        def data_dir = &#x22;/mnt/mall/h5/h5_vip&#x22;

        // æœ¬åœ°éœ€è¦ä¸Šä¼ çš„ç›®å½• ä»¥åŠè¿œç¨‹æœåŠ¡å™¨çš„ç›®å½•
        def localDir = &#x22;${WORKSPACE}/h5_vip/test_dir/&#x22;
        def vip_host = &#x27;152.22.3.186&#x27;
        def vip_remote_dir = &#x22;/mnt/mall/h5&#x22;
    }
    stages {
        stage(&#x27;Git Checkout&#x27;) {
            steps {
                echo &#x22;ğŸ† WORKSPACE: ã€${WORKSPACE}ã€‘&#x22;
                echo &#x22;ğŸ¯ branch: ã€${git_branch}ã€‘&#x22;
                echo &#x22;ğŸ… project_env: ã€${project_env}ã€‘&#x22;
                echo &#x27;check git&#x27;
                checkout([
                    $class: &#x27;GitSCM&#x27;,
                    branches: [[name: &#x22;${git_branch}&#x22; ]],
                    doGenerateSubmoduleConfigurations: false,
                    extensions: [],
                    submoduleCfg: [],
                    userRemoteConfigs: [[
                    credentialsId: &#x22;${git_auth}&#x22;,
                        url: &#x22;${git_url}&#x22;
                    ]]
                ])
                sh &#x27;pwd&#x27;
                sh &#x27;ls -la&#x27;
            }    
        }
        stage(&#x27;Send Files&#x27;) {
            when {
                expression {
                    currentBuild.result == null || currentBuild.result == &#x27;SUCCESS&#x27;
                }
            }
            steps {
                sh &#x27;pwd&#x27;
                script {
                    switch (project_env) {
                        case &#x22;vip&#x22;:
                            sh &#x27;&#x27;&#x27;
                            ls -la
                            cd h5_vip
                            npm install --cache /home/node/.npm --registry=https://registry.npmmirror.com/
                            ls -la
                            npm run build
                            ls -la
                            rm -rf test_dir
                            mv dist test_dir
                            &#x27;&#x27;&#x27;
                            withCredentials([sshUserPrivateKey(credentialsId: &#x27;9dfd-4fd5-b94b-7559ca212e9a&#x27;, keyFileVariable: &#x27;SSH_KEY&#x27;)]) {
                                // è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å¹¶åˆ é™¤ test_dir ç›®å½• é‡æ–°ä¸Šä¼ 
                                sh &#x27;&#x27;&#x27;
                                ssh -i ${SSH_KEY} -o StrictHostKeyChecking=no root@152.22.3.186 &#x22;rm -rf /mnt/mall/h5/test_dir&#x22;
                                scp -i ${SSH_KEY} -o StrictHostKeyChecking=no -P 22 -r &#x22;${localDir}&#x22; root@152.22.3.186:${vip_remote_dir}
                                &#x27;&#x27;&#x27;
                            }
                            break
                        case &#x22;dev&#x22;:
                            // for (i in [&#x27;152.22.3.186&#x27;]) {
                            //     data_dir = &#x22;/mnt/mall/h5/&#x22;
                            //     //sh &#x22;ssh $i &#x27;cp -rf ${data_dir}/* ${data_dir}/h5_vip_{uuid_no}&#x27;&#x22;
                            //     sh &#x22;scp -r -o StrictHostKeyChecking=no -i /var/lib/jenkins/.ssh/id_rsa -P 22 &#x27;${WORKSPACE}/h5_vip/&#x27; &#x27;$i:${data_dir}&#x27;&#x22;
                            // }
                            break
                    }
                }
            }
        }
    }
    post {
        success {
            sh &#x22;echo &#x27;Success success&#x27;&#x22;
        }
        
        failure {
            sh &#x22;echo &#x27;Faild faild&#x27;&#x22;
        }
    }
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="java-ç¯å¢ƒ"><a aria-hidden="true" tabindex="-1" href="#java-ç¯å¢ƒ" class="anchor"><span class="icon icon-link"></span></a>Java ç¯å¢ƒ</h2>
        <p>åŸºäº <code>openjdk:11</code> åˆ›å»ºä¸€ä¸ªåŒ…å« <code>Maven</code> çš„è‡ªå®šä¹‰ Docker é•œåƒ</p>
        <pre class="language-dockerfile"><code class="language-dockerfile code-highlight"><span class="code-line line-number" line="1"><span class="token instruction"><span class="token keyword">FROM</span> <span class="token options"><span class="token property">--platform</span><span class="token punctuation">=</span><span class="token string">linux/amd64</span></span> openjdk:11</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token comment"># å®‰è£… Maven 3.8.7</span>
</span><span class="code-line line-number" line="4"><span class="token instruction"><span class="token keyword">ENV</span> MAVEN_VERSION=3.8.7</span>
</span><span class="code-line line-number" line="5"><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &#x26;&#x26; apt-get install -y wget tar <span class="token operator">\</span>
</span></span><span class="code-line line-number" line="6"><span class="token instruction">    &#x26;&#x26; wget https://archive.apache.org/dist/maven/maven-3/<span class="token variable">${MAVEN_VERSION}</span>/binaries/apache-maven-<span class="token variable">${MAVEN_VERSION}</span>-bin.tar.gz <span class="token operator">\</span>
</span></span><span class="code-line line-number" line="7"><span class="token instruction">    &#x26;&#x26; tar xzf apache-maven-<span class="token variable">${MAVEN_VERSION}</span>-bin.tar.gz -C /opt <span class="token operator">\</span>
</span></span><span class="code-line line-number" line="8"><span class="token instruction">    &#x26;&#x26; ln -s /opt/apache-maven-<span class="token variable">${MAVEN_VERSION}</span> /opt/maven <span class="token operator">\</span>
</span></span><span class="code-line line-number" line="9"><span class="token instruction">    &#x26;&#x26; rm apache-maven-<span class="token variable">${MAVEN_VERSION}</span>-bin.tar.gz</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11"><span class="token comment"># è®¾ç½® Maven ç¯å¢ƒå˜é‡</span>
</span><span class="code-line line-number" line="12"><span class="token instruction"><span class="token keyword">ENV</span> MAVEN_HOME=/opt/maven</span>
</span><span class="code-line line-number" line="13"><span class="token instruction"><span class="token keyword">ENV</span> PATH=<span class="token string">"${MAVEN_HOME}/bin:${PATH}"</span></span>
</span><span class="code-line line-number" line="14">
</span><span class="code-line line-number" line="15"><span class="token comment"># åˆ›å»ºé root ç”¨æˆ·å¹¶è®¾ç½®æƒé™</span>
</span><span class="code-line line-number" line="16"><span class="token instruction"><span class="token keyword">RUN</span> useradd -u 1000 -ms /bin/bash jenkins <span class="token operator">\</span>
</span></span><span class="code-line line-number" line="17"><span class="token instruction">    &#x26;&#x26; mkdir -p /home/jenkins/.m2/repository <span class="token operator">\</span>
</span></span><span class="code-line line-number" line="18"><span class="token instruction">    &#x26;&#x26; chown -R jenkins:jenkins /home/jenkins/.m2</span>
</span><span class="code-line line-number" line="19">
</span><span class="code-line line-number" line="20"><span class="token comment"># åˆ‡æ¢åˆ°é root ç”¨æˆ·</span>
</span><span class="code-line line-number" line="21"><span class="token instruction"><span class="token keyword">USER</span> jenkins</span>
</span><span class="code-line line-number" line="22">
</span><span class="code-line line-number" line="23"><span class="token comment"># éªŒè¯ Maven ç‰ˆæœ¬</span>
</span><span class="code-line line-number" line="24"><span class="token instruction"><span class="token keyword">RUN</span> mvn -version</span>
</span></code><input type="hidden" value="FROM --platform=linux/amd64 openjdk:11

# å®‰è£… Maven 3.8.7
ENV MAVEN_VERSION=3.8.7
RUN apt-get update &#x26;&#x26; apt-get install -y wget tar \
    &#x26;&#x26; wget https://archive.apache.org/dist/maven/maven-3/${MAVEN_VERSION}/binaries/apache-maven-${MAVEN_VERSION}-bin.tar.gz \
    &#x26;&#x26; tar xzf apache-maven-${MAVEN_VERSION}-bin.tar.gz -C /opt \
    &#x26;&#x26; ln -s /opt/apache-maven-${MAVEN_VERSION} /opt/maven \
    &#x26;&#x26; rm apache-maven-${MAVEN_VERSION}-bin.tar.gz

# è®¾ç½® Maven ç¯å¢ƒå˜é‡
ENV MAVEN_HOME=/opt/maven
ENV PATH=&#x22;${MAVEN_HOME}/bin:${PATH}&#x22;

# åˆ›å»ºé root ç”¨æˆ·å¹¶è®¾ç½®æƒé™
RUN useradd -u 1000 -ms /bin/bash jenkins \
    &#x26;&#x26; mkdir -p /home/jenkins/.m2/repository \
    &#x26;&#x26; chown -R jenkins:jenkins /home/jenkins/.m2

# åˆ‡æ¢åˆ°é root ç”¨æˆ·
USER jenkins

# éªŒè¯ Maven ç‰ˆæœ¬
RUN mvn -version
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>æ„å»º <code>openjdk</code> æ–°çš„é•œåƒï¼Œå‘½åä¸º <code>my-openjdk-maven</code></p>
        <pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line line-number" line="1"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> my-openjdk-maven:3.8.7 <span class="token builtin class-name">.</span>
</span><span class="code-line line-number" line="2"><span class="token comment"># ä¿å­˜ Docker é•œåƒåˆ°æœ¬åœ°æ–‡ä»¶</span>
</span><span class="code-line line-number" line="3"><span class="token function">docker</span> save <span class="token parameter variable">-o</span> my-openjdk-maven.3.8.7.tar my-openjdk-maven:3.8.7
</span><span class="code-line line-number" line="4"><span class="token function">docker</span> save <span class="token parameter variable">-o</span> my-openjdk-maven.3.8.8.tar my-openjdk-maven:3.8.8
</span><span class="code-line line-number" line="5"><span class="token comment"># ä¸Šä¼ åˆ°æœåŠ¡å™¨</span>
</span><span class="code-line line-number" line="6"><span class="token function">scp</span> <span class="token parameter variable">-P</span> <span class="token number">2222</span> my-openjdk-maven.3.8.7.tar root@106.55.8.163:/home/docker-images
</span></code><input type="hidden" value="docker build -t my-openjdk-maven:3.8.7 .
# ä¿å­˜ Docker é•œåƒåˆ°æœ¬åœ°æ–‡ä»¶
docker save -o my-openjdk-maven.3.8.7.tar my-openjdk-maven:3.8.7
docker save -o my-openjdk-maven.3.8.8.tar my-openjdk-maven:3.8.8
# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp -P 2222 my-openjdk-maven.3.8.7.tar root@106.55.8.163:/home/docker-images
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>åŠ è½½ docker è‡ªå®šä¹‰é•œåƒ</p>
        <pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line line-number" line="1"><span class="token function">docker</span> load <span class="token parameter variable">-i</span> ./my-openjdk-maven.3.8.7.tar
</span></code><input type="hidden" value="docker load -i ./my-openjdk-maven.3.8.7.tar
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>ç¼“å­˜ä¸‹è½½çš„ <code>maven</code> çš„åŒ…</p>
        <pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line line-number" line="1"><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--rm</span> my-openjdk-maven:3.8.7 /bin/bash
</span><span class="code-line line-number" line="2"><span class="token comment"># åœ¨ã€å®¹å™¨ã€‘å†…è¿è¡Œ</span>
</span><span class="code-line line-number" line="3"><span class="token function">id</span> jenkins
</span><span class="code-line line-number" line="4"><span class="token comment"># uid=1000(jenkins) gid=1000(jenkins) groups=1000(jenkins)</span>
</span><span class="code-line line-number" line="5"><span class="token comment"># åœ¨ã€å®¿ä¸»æœºã€‘ä¸Šä½¿ç”¨è¿™äº› ID æ¥æ›´æ”¹ç›®å½•çš„æ‹¥æœ‰è€…</span>
</span><span class="code-line line-number" line="6"><span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> <span class="token number">1000</span>:1000 /root/.m2/
</span><span class="code-line line-number" line="7"><span class="token comment"># å°†ç›®å½•æƒé™è®¾ç½®ä¸ºå¯è¯»å†™</span>
</span><span class="code-line line-number" line="8"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">777</span> /root/.m2/
</span></code><input type="hidden" value="docker run -it --rm my-openjdk-maven:3.8.7 /bin/bash
# åœ¨ã€å®¹å™¨ã€‘å†…è¿è¡Œ
id jenkins
# uid=1000(jenkins) gid=1000(jenkins) groups=1000(jenkins)
# åœ¨ã€å®¿ä¸»æœºã€‘ä¸Šä½¿ç”¨è¿™äº› ID æ¥æ›´æ”¹ç›®å½•çš„æ‹¥æœ‰è€…
sudo chown -R 1000:1000 /root/.m2/
# å°†ç›®å½•æƒé™è®¾ç½®ä¸ºå¯è¯»å†™
sudo chmod -R 777 /root/.m2/
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>Pipeline è„šæœ¬ä¸­ä½¿ç”¨ Docker java <code>openjdk:11</code> &#x26; <code>maven.3.8.7</code> è¿è¡Œç¤ºä¾‹</p>
        <pre class="language-groovy"><code class="language-groovy code-highlight"><span class="code-line line-number" line="1">pipeline <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">    agent <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">        docker <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">            image <span class="token string">'my-openjdk-maven:3.8.7'</span>
</span><span class="code-line line-number" line="5">            <span class="token comment">// å°† Maven çš„æœ¬åœ°ä»“åº“æŒ‚è½½åˆ°å®¹å™¨çš„ /root/.m2 è·¯å¾„ï¼Œ</span>
</span><span class="code-line line-number" line="6">            <span class="token comment">// ç¡®ä¿ä½ æ¯æ¬¡æ„å»ºæ—¶éƒ½èƒ½é‡ç”¨ä¹‹å‰ä¸‹è½½çš„ä¾èµ–</span>
</span><span class="code-line line-number" line="7">            args <span class="token string">'-v /root/.m2:/home/jenkins/.m2:rw'</span>
</span><span class="code-line line-number" line="8">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="9">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="10">    environment <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">        <span class="token keyword">def</span> git_url<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">"http://106.55.8.163:8081/mall/springboot-mall.git"</span></span>
</span><span class="code-line line-number" line="12">        <span class="token keyword">def</span> git_auth <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"211ca2-55c4f199-4b15-b087-238db80b102d"</span></span>
</span><span class="code-line line-number" line="13">        <span class="token keyword">def</span> git_branch <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">branch</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
</span><span class="code-line line-number" line="14">        <span class="token keyword">def</span> project_env <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">project_env</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
</span><span class="code-line line-number" line="15">        <span class="token keyword">def</span> vip_host <span class="token operator">=</span> <span class="token string">'152.22.3.186'</span>
</span><span class="code-line line-number" line="16">        <span class="token keyword">def</span> vip_remote_dir <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"/mnt/mall/admin"</span></span>
</span><span class="code-line line-number" line="17">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="18">    stages <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="19">        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Git Checkout'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="20">            steps <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="21">                echo <span class="token string">'check git'</span>
</span><span class="code-line line-number" line="22">                <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
</span><span class="code-line line-number" line="23">                    <span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'GitSCM'</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="24">                    branches<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">git_branch</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="25">                    doGenerateSubmoduleConfigurations<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="26">                    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span>
</span><span class="code-line line-number" line="27">                    <span class="token comment">// åªæ‹‰å–æœ€æ–°çš„æäº¤</span>
</span><span class="code-line line-number" line="28">                    <span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'CloneOption'</span><span class="token punctuation">,</span> depth<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> shallow<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> noTags<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="29">                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="30">                    submoduleCfg<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="31">                    userRemoteConfigs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>
</span><span class="code-line line-number" line="32">                    credentialsId<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">git_auth</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="33">                        url<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">git_url</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
</span><span class="code-line line-number" line="34">                    <span class="token punctuation">]</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="35">                <span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="36">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="37">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="38">        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Manven Build'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="39">            steps <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="40">                <span class="token comment">/**
</span></span><span class="code-line line-number" line="41"><span class="token comment">                * æ‰§è¡Œmavenæ‰“åŒ…
</span></span><span class="code-line line-number" line="42"><span class="token comment">                * -B --batch-mode åœ¨éäº¤äº’ï¼ˆæ‰¹å¤„ç†ï¼‰æ¨¡å¼ä¸‹è¿è¡Œ(è¯¥æ¨¡å¼ä¸‹,å½“Mvenéœ€è¦è¾“å…¥æ—¶,å®ƒä¸ä¼šåœä¸‹æ¥æ¥å—ç”¨æˆ·çš„è¾“å…¥,è€Œæ˜¯ä½¿ç”¨åˆç†çš„é»˜è®¤å€¼)
</span></span><span class="code-line line-number" line="43"><span class="token comment">                * æ‰“åŒ…æ—¶è·³è¿‡JUnitæµ‹è¯•ç”¨ä¾‹
</span></span><span class="code-line line-number" line="44"><span class="token comment">                * -DskipTests ä¸æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œä½†ç¼–è¯‘æµ‹è¯•ç”¨ä¾‹ç±»ç”Ÿæˆç›¸åº”çš„classæ–‡ä»¶è‡³target/test-classesä¸‹
</span></span><span class="code-line line-number" line="45"><span class="token comment">                * -Dmaven.test.skip=trueï¼Œä¸æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œä¹Ÿä¸ç¼–è¯‘æµ‹è¯•ç”¨ä¾‹ç±»
</span></span><span class="code-line line-number" line="46"><span class="token comment">                **/</span>
</span><span class="code-line line-number" line="47">                sh <span class="token interpolation-string"><span class="token string">"cd </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">WORKSPACE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ; mvn clean package -Dmaven.test.skip=true -Dmaven.repo.local=/home/jenkins/.m2/repository -U"</span></span>
</span><span class="code-line line-number" line="48">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="49">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="50">        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Send Files'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="51">            when <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="52">                expression <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="53">                currentBuild<span class="token punctuation">.</span>result <span class="token operator">==</span> null <span class="token operator">||</span> currentBuild<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">'SUCCESS'</span>
</span><span class="code-line line-number" line="54">                <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="55">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="56">            steps <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="57">                script <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="58">                    <span class="token keyword">switch</span> <span class="token punctuation">(</span>project_env<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="59">                        <span class="token keyword">case</span> <span class="token interpolation-string"><span class="token string">"pro"</span></span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="60">                            <span class="token comment">// éƒ¨ç½²æœåŠ¡å™¨ SSH å‡­æ®ï¼ŒéªŒè¯ç™»å½•ç”¨ï¼Œæ‰å¯ä»¥ ssh å’Œ scp ä¸Šä¼ ç­‰åŠŸèƒ½</span>
</span><span class="code-line line-number" line="61">                            <span class="token function">withCredentials</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">sshUserPrivateKey</span><span class="token punctuation">(</span>credentialsId<span class="token punctuation">:</span> <span class="token string">'bd6f00e69dfd-4fd5-b94b-7559ca212e9a'</span><span class="token punctuation">,</span> keyFileVariable<span class="token punctuation">:</span> <span class="token string">'SSH_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="62">                                <span class="token comment">// è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å¹¶åˆ é™¤ admin ç›®å½• é‡æ–°ä¸Šä¼ </span>
</span><span class="code-line line-number" line="63">                                sh <span class="token string">'''
</span></span><span class="code-line line-number" line="64"><span class="token string">                                scp -i ${SSH_KEY} -o StrictHostKeyChecking=no -r -P 22 '${WORKSPACE}/admin/target/lib' 'root@${vip_host}:${vip_remote_dir}'
</span></span><span class="code-line line-number" line="65"><span class="token string">                                scp -i ${SSH_KEY} -o StrictHostKeyChecking=no -r -P 22 '${WORKSPACE}/admin/target/admin-2.3.jar' 'root@${vip_host}:${vip_remote_dir}'
</span></span><span class="code-line line-number" line="66"><span class="token string">                                ssh -i ${SSH_KEY} -o StrictHostKeyChecking=no root@${vip_host} '/mnt/sh/admin-8000.sh restart;'
</span></span><span class="code-line line-number" line="67"><span class="token string">                                '''</span>
</span><span class="code-line line-number" line="68">                            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="69">                            <span class="token keyword">break</span>
</span><span class="code-line line-number" line="70">                        <span class="token keyword">case</span> <span class="token interpolation-string"><span class="token string">"dev"</span></span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="71">
</span><span class="code-line line-number" line="72">                            <span class="token keyword">break</span>
</span><span class="code-line line-number" line="73">                    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="74">                <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="75">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="76">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="77">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="78">    post <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="79">        success <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="80">            sh <span class="token interpolation-string"><span class="token string">"echo 'Success success'"</span></span>
</span><span class="code-line line-number" line="81">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="82">        failure <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="83">            sh <span class="token interpolation-string"><span class="token string">"echo 'Faild faild'"</span></span>
</span><span class="code-line line-number" line="84">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="85">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="86"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="pipeline {
    agent {
        docker {
            image &#x27;my-openjdk-maven:3.8.7&#x27;
            // å°† Maven çš„æœ¬åœ°ä»“åº“æŒ‚è½½åˆ°å®¹å™¨çš„ /root/.m2 è·¯å¾„ï¼Œ
            // ç¡®ä¿ä½ æ¯æ¬¡æ„å»ºæ—¶éƒ½èƒ½é‡ç”¨ä¹‹å‰ä¸‹è½½çš„ä¾èµ–
            args &#x27;-v /root/.m2:/home/jenkins/.m2:rw&#x27;
        }
    }
    environment {
        def git_url=&#x22;http://106.55.8.163:8081/mall/springboot-mall.git&#x22;
        def git_auth = &#x22;211ca2-55c4f199-4b15-b087-238db80b102d&#x22;
        def git_branch = &#x22;${branch}&#x22;
        def project_env = &#x22;${project_env}&#x22;
        def vip_host = &#x27;152.22.3.186&#x27;
        def vip_remote_dir = &#x22;/mnt/mall/admin&#x22;
    }
    stages {
        stage(&#x27;Git Checkout&#x27;) {
            steps {
                echo &#x27;check git&#x27;
                checkout([
                    $class: &#x27;GitSCM&#x27;,
                    branches: [[name: &#x22;${git_branch}&#x22; ]],
                    doGenerateSubmoduleConfigurations: false,
                    extensions: [
                    // åªæ‹‰å–æœ€æ–°çš„æäº¤
                    [$class: &#x27;CloneOption&#x27;, depth: 1, shallow: true, noTags: true]
                    ],
                    submoduleCfg: [],
                    userRemoteConfigs: [[
                    credentialsId: &#x22;${git_auth}&#x22;,
                        url: &#x22;${git_url}&#x22;
                    ]]
                ])
            }
        }
        stage(&#x27;Manven Build&#x27;) {
            steps {
                /**
                * æ‰§è¡Œmavenæ‰“åŒ…
                * -B --batch-mode åœ¨éäº¤äº’ï¼ˆæ‰¹å¤„ç†ï¼‰æ¨¡å¼ä¸‹è¿è¡Œ(è¯¥æ¨¡å¼ä¸‹,å½“Mvenéœ€è¦è¾“å…¥æ—¶,å®ƒä¸ä¼šåœä¸‹æ¥æ¥å—ç”¨æˆ·çš„è¾“å…¥,è€Œæ˜¯ä½¿ç”¨åˆç†çš„é»˜è®¤å€¼)
                * æ‰“åŒ…æ—¶è·³è¿‡JUnitæµ‹è¯•ç”¨ä¾‹
                * -DskipTests ä¸æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œä½†ç¼–è¯‘æµ‹è¯•ç”¨ä¾‹ç±»ç”Ÿæˆç›¸åº”çš„classæ–‡ä»¶è‡³target/test-classesä¸‹
                * -Dmaven.test.skip=trueï¼Œä¸æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œä¹Ÿä¸ç¼–è¯‘æµ‹è¯•ç”¨ä¾‹ç±»
                **/
                sh &#x22;cd ${WORKSPACE} ; mvn clean package -Dmaven.test.skip=true -Dmaven.repo.local=/home/jenkins/.m2/repository -U&#x22;
            }
        }
        stage(&#x27;Send Files&#x27;) {
            when {
                expression {
                currentBuild.result == null || currentBuild.result == &#x27;SUCCESS&#x27;
                }
            }
            steps {
                script {
                    switch (project_env) {
                        case &#x22;pro&#x22;:
                            // éƒ¨ç½²æœåŠ¡å™¨ SSH å‡­æ®ï¼ŒéªŒè¯ç™»å½•ç”¨ï¼Œæ‰å¯ä»¥ ssh å’Œ scp ä¸Šä¼ ç­‰åŠŸèƒ½
                            withCredentials([sshUserPrivateKey(credentialsId: &#x27;bd6f00e69dfd-4fd5-b94b-7559ca212e9a&#x27;, keyFileVariable: &#x27;SSH_KEY&#x27;)]) {
                                // è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å¹¶åˆ é™¤ admin ç›®å½• é‡æ–°ä¸Šä¼ 
                                sh &#x27;&#x27;&#x27;
                                scp -i ${SSH_KEY} -o StrictHostKeyChecking=no -r -P 22 &#x27;${WORKSPACE}/admin/target/lib&#x27; &#x27;root@${vip_host}:${vip_remote_dir}&#x27;
                                scp -i ${SSH_KEY} -o StrictHostKeyChecking=no -r -P 22 &#x27;${WORKSPACE}/admin/target/admin-2.3.jar&#x27; &#x27;root@${vip_host}:${vip_remote_dir}&#x27;
                                ssh -i ${SSH_KEY} -o StrictHostKeyChecking=no root@${vip_host} &#x27;/mnt/sh/admin-8000.sh restart;&#x27;
                                &#x27;&#x27;&#x27;
                            }
                            break
                        case &#x22;dev&#x22;:

                            break
                    }
                }
            }
        }
    }
    post {
        success {
            sh &#x22;echo &#x27;Success success&#x27;&#x22;
        }
        failure {
            sh &#x22;echo &#x27;Faild faild&#x27;&#x22;
        }
    }
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <div class="previous"><a class="prev" href="../redis.html"><svg viewBox="0 0 1024 1024" width="16" height="16" fill="currentColor">
              <path d="M842.666667 864c-8.533333 0-14.933333-2.133333-21.333334-8.533333l-341.333333-309.333334c-6.4-6.4-10.666667-14.933333-10.666667-23.466666 0-8.533333 4.266667-17.066667 10.666667-23.466667l341.333333-309.333333c12.8-12.8 34.133333-10.666667 44.8 2.133333 12.8 12.8 10.666667 34.133333-2.133333 44.8L548.266667 522.666667l315.733333 285.866666c12.8 10.666667 14.933333 32 2.133333 44.8-6.4 6.4-14.933333 10.666667-23.466666 10.666667z"></path>
              <path d="M512 864c-8.533333 0-14.933333-2.133333-21.333333-8.533333L149.333333 546.133333c-6.4-6.4-10.666667-14.933333-10.666666-23.466666 0-8.533333 4.266667-17.066667 10.666666-23.466667L490.666667 189.866667c12.8-12.8 34.133333-10.666667 44.8 2.133333 12.8 12.8 10.666667 34.133333-2.133334 44.8L217.6 522.666667 533.333333 808.533333c12.8 12.8 14.933333 32 2.133334 44.8-6.4 6.4-14.933333 10.666667-23.466667 10.666667z"></path>
            </svg>
<span>Redis æ•°æ®åº“
</span></a><a class="next" href="../rocket.chat/index.html"><span>Rocket.Chat èŠå¤©å·¥å…·
</span><svg viewBox="0 0 1024 1024" width="16" height="16" fill="currentColor">
              <path d="M544 522.666667c0-8.533333-4.266667-17.066667-10.666667-23.466667L192 189.866667c-12.8-12.8-34.133333-10.666667-44.8 2.133333-12.8 12.8-10.666667 34.133333 2.133333 44.8l315.733334 285.866667L149.333333 808.533333c-12.8 12.8-14.933333 32-2.133333 44.8 6.4 6.4 14.933333 10.666667 23.466667 10.666667 8.533333 0 14.933333-2.133333 21.333333-8.533333l341.333333-309.333334c6.4-6.4 10.666667-14.933333 10.666667-23.466666z"></path>
              <path d="M864 499.2l-341.333333-309.333333c-12.8-12.8-34.133333-10.666667-44.8 2.133333-12.8 12.8-10.666667 34.133333 2.133333 44.8l315.733333 285.866667-315.733333 285.866666c-12.8 12.8-14.933333 32-2.133333 44.8 6.4 6.4 14.933333 10.666667 23.466666 10.666667 8.533333 0 14.933333-2.133333 21.333334-8.533333l341.333333-309.333334c6.4-6.4 10.666667-14.933333 10.666667-23.466666 0-8.533333-4.266667-17.066667-10.666667-23.466667z"></path>
            </svg></a></div>
        <section class="article-footer"><a href="https://github.com/jaywcjlove/docker-tutorial/tree/master/docs/jenkins/README.md" class="edit-button" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
<span>Edit this page on GitHub</span>
</a><span class="atime">2024/07/22</span></section>
      </markdown-style>
      <nav class="tocs">
        <aside class="inner toc">
          <ol class="tocs-list">
            <li><a href="#éƒ¨ç½²-jenkins" class="tocs-link">éƒ¨ç½² Jenkins</a></li>
            <li><a href="#1-å®‰è£…æ’ä»¶" class="tocs-link">1. å®‰è£…æ’ä»¶</a></li>
            <li><a href="#2-æ·»åŠ å‡­æ®" class="tocs-link">2. æ·»åŠ å‡­æ®</a></li>
            <li><a href="#3-æ–°å»ºå·¥ä½œæµ" class="tocs-link">3. æ–°å»ºå·¥ä½œæµ</a></li>
            <li><a href="#3-æ·»åŠ æ„å»ºé€‰é¡¹" class="tocs-link">3. æ·»åŠ æ„å»ºé€‰é¡¹</a></li>
            <li><a href="#4-é€‰æ‹©-pipeline-script-from-scm-æŒ‡å®šè„šæœ¬ä½ç½®" class="tocs-link">4. é€‰æ‹© Pipeline script from SCM æŒ‡å®šè„šæœ¬ä½ç½®</a></li>
            <li><a href="#nodejs" class="tocs-link">Nodejs</a></li>
            <li><a href="#java-ç¯å¢ƒ" class="tocs-link">Java ç¯å¢ƒ</a></li>
          </ol>
        </aside>
      </nav>
    </div>
    <script src="../js/demo-preview.js?v=1.31.0"></script>
    <div class="footer warpper">
      <a href="https://wangchujiang.com/#/app" target="_blank">App</a> â€¢
      <a href="https://wangchujiang.com/#/projects" target="_blank">Projects</a> â€¢
      <a href="https://wangchujiang.com/#/sponsor" target="_blank">Sponsor</a> â€¢
      <a href="https://wangchujiang.com/#/app" target="_blank">More Apps</a><br><br>Released under the MIT License. Copyright Â© 2024 <a href="https://wangchujiang.com/#/about" target="_blank">Kenny Wong</a><br>Generated by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a> v1.31.0
    </div>
    <script src="../js/tocbot.js?v=1.31.0"></script>
  </body>
</html>
